(()=>{(function(){var e={NAME_:{en_US:"Name",fr_FR:"Nom",ja_JP:"\u540D\u524D",nl_NL:"Naam",zh_CN:"\u59D3\u540D"},PASSWORD_:{en_US:"Password",de_DE:"Passwort",fr_FR:"Mot de passe",ja_JP:"\u30D1\u30B9\u30EF\u30FC\u30C9",nl_NL:"Wachtwoord",zh_CN:"\u5BC6\u7801"},CONNECT_:{en_US:"Connect",de_DE:"Verbinden",fr_FR:"Connexion",ja_JP:"\u63A5\u7D9A",nl_NL:"Verbinden",zh_CN:"\u8FDE\u63A5"},SET_CMIS_API_URL_:{en_US:"A Connection URL must be set in the Plugin configuration within the Administration Page.",de_DE:"Eine Verbindungs-URL muss in den Einstellungen des Plugins auf der Administrationsseite festgelegt werden.",fr_FR:"Une URL de connexion doit \xEAtre d\xE9finie dans la configuration du plugin dans la page d'administration.",ja_JP:"\u7BA1\u7406\u30DA\u30FC\u30B8\u5185\u306E\u30D7\u30E9\u30B0\u30A4\u30F3\u69CB\u6210\u3067\u63A5\u7D9AURL\u3092\u8A2D\u5B9A\u3059\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059\u3002",nl_NL:"Er moet een verbindings-URL worden ingesteld in de plug-inconfiguratie op de beheerpagina.",zh_CN:"\u5FC5\u987B\u5728\u7BA1\u7406\u9875\u5185\u7684\u63D2\u4EF6\u914D\u7F6E\u4E2D\u8BBE\u7F6E\u8FDE\u63A5URL\u3002"},ALL_VERSIONS_:{en_US:"Show Version History",de_DE:"Zeige Versionshistorie",fr_FR:"Afficher l'historique des versions",ja_JP:"\u30D0\u30FC\u30B8\u30E7\u30F3\u5C65\u6B74\u3092\u8868\u793A\u3059\u308B",nl_NL:"Versiegeschiedenis weergeven",zh_CN:"\u663E\u793A\u7248\u672C\u5386\u53F2\u8BB0\u5F55"},Diff:{en_US:"Diff",fr_FR:"Comparaison",ja_JP:"\u6BD4\u8F03",zh_CN:"\u5DEE\u5F02"},VERSION_HISTORY:{en_US:"Version History",de_DE:"Versionshistorie",fr_FR:"Historique des versions",ja_JP:"\u30D0\u30FC\u30B8\u30E7\u30F3\u5C65\u6B74",nl_NL:"Versiegeschiedenis",zh_CN:"\u7248\u672C\u5386\u53F2"},LEFT_DIFF_DOC:{en_US:"Left-side diff document",de_DE:"Dokument zum Vergleichen auf der linken Seite",fr_FR:"Document de gauche \xE0 comparer",ja_JP:"\u6BD4\u8F03\u3059\u308B\u5DE6\u5074\u306E\u30C9\u30AD\u30E5\u30E1\u30F3\u30C8",nl_NL:"Document aan de linkerkant om te vergelijken",zh_CN:"\u7528\u4E8E\u6BD4\u8F83\u7684\u5DE6\u4FA7\u6587\u6863"},RIGHT_DIFF_DOC:{en_US:"Right-side diff document",de_DE:"Dokument zum Vergleichen auf der rechten Seite",fr_FR:"Document de droite \xE0 comparer",ja_JP:"\u6BD4\u8F03\u3059\u308B\u53F3\u5074\u306E\u30C9\u30AD\u30E5\u30E1\u30F3\u30C8",nl_NL:"Document aan de rechterkant om te vergelijken",zh_CN:"\u7528\u4E8E\u6BD4\u8F83\u7684\u53F3\u4FA7\u6587\u6863"},CMIS_CANCEL_CHECK_OUT:{en_US:"Discard Check Out",de_DE:"Check-Out abbrechen",fr_FR:"Annuler l'extraction",ja_JP:"\u30C1\u30A7\u30C3\u30AF\u30A2\u30A6\u30C8\u3092\u7834\u68C4\u3059\u308B",nl_NL:"Uitchecken negeren",zh_CN:"\u653E\u5F03\u7B7E\u51FA"},CANCEL_:{en_US:"Cancel",de_DE:"Abbrechen",fr_FR:"Annuler",ja_JP:"\u30AD\u30E3\u30F3\u30BB\u30EB",nl_NL:"Annuleer",zh_CN:"\u53D6\u6D88"},CMIS_LOSE_CHANGES_:{en_US:"If you discard your Check Out you will lose all changes made to the document.",de_DE:"Wenn Sie Ihren Check-Out abbrechen, werden Sie alle in dem Dokument durchgef\xFChrten \xC4nderungen verlieren.",fr_FR:"Si vous annulez votre extraction, vous perdrez toutes les modifications apport\xE9es au document.",ja_JP:"\u30C1\u30A7\u30C3\u30AF\u30A2\u30A6\u30C8\u3092\u7834\u68C4\u3057\u305F\u5834\u5408\u3001\u30C9\u30AD\u30E5\u30E1\u30F3\u30C8\u306B\u52A0\u3048\u3089\u308C\u305F\u3059\u3079\u3066\u306E\u5909\u66F4\u304C\u5931\u308F\u308C\u307E\u3059\u3002",nl_NL:"Als u het uitchecken negeert, gaan alle aangebrachte wijzigingen aan het document verloren.",zh_CN:"\u5982\u679C\u653E\u5F03\u7B7E\u51FA\uFF0C\u5219\u5C06\u4E22\u5931\u5BF9\u6587\u6863\u6240\u505A\u7684\u6240\u6709\u66F4\u6539\u3002"},CMIS_CANCEL_WARNING_:{en_US:"Are you sure you want to discard your Check Out?",de_DE:"Sind Sie sicher, dass Sie den Check-Out abbrechen m\xF6chten?",fr_FR:"\xCAtes-vous s\xFBr de vouloir annuler votre extraction ?",ja_JP:"\u30C1\u30A7\u30C3\u30AF\u30A2\u30A6\u30C8\u3092\u7834\u68C4\u3057\u307E\u3059\u304B\uFF1F",nl_NL:"Weet u zeker dat u het uitchecken wilt negeren?",zh_CN:"\u662F\u5426\u786E\u5B9E\u8981\u653E\u5F03\u7B7E\u51FA\uFF1F"},CMIS_CHECK_IN:{en_US:"Check In",de_DE:"Check-In",fr_FR:"Enregistrer",ja_JP:"\u30C1\u30A7\u30C3\u30AF\u30A4\u30F3",nl_NL:"Inchecken",zh_CN:"\u767B\u8BB0\u5165\u4F4F"},SAVE_CHANGES_BEFORE_CHECK_IN_:{en_US:"Changes need to be saved before you can check in the document.",de_DE:"\xC4nderungen m\xFCssen gespeichert werden, bevor Sie das Dokument einchecken k\xF6nnen.",fr_FR:"Les modifications doivent \xEAtre sauvegard\xE9es avant de pouvoir enregistrer le document.",ja_JP:"\u30C9\u30AD\u30E5\u30E1\u30F3\u30C8\u3092\u30C1\u30A7\u30C3\u30AF\u30A4\u30F3\u3059\u308B\u524D\u306B\u3001\u5909\u66F4\u5185\u5BB9\u3092\u4FDD\u5B58\u3059\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059\u3002",nl_NL:"Wijzigingen moeten worden opgeslagen voordat u het document kunt inchecken.",zh_CN:"\u5728\u7B7E\u5165\u6587\u6863\u4E4B\u524D\uFF0C\u9700\u8981\u4FDD\u5B58\u66F4\u6539\u3002"},MAJOR_VERSION_:{en_US:"Major version",de_DE:"Hauptversion",fr_FR:"Version majeure",ja_JP:"\u30E1\u30B8\u30E3\u30FC\u30D0\u30FC\u30B8\u30E7\u30F3",nl_NL:"Grote versie",zh_CN:"\u4E3B\u8981\u7248\u672C"},MINOR_VERSION_:{en_US:"Minor version",de_DE:"Unterversion",fr_FR:"Version mineure",ja_JP:"\u30DE\u30A4\u30CA\u30FC\u30D0\u30FC\u30B8\u30E7\u30F3",nl_NL:"Kleine versie",zh_CN:"\u6B21\u8981\u7248\u672C"},CHECK_IN_MESSAGE_:{en_US:"Enter the commit message:",de_DE:"Commit-Nachricht eingeben:",fr_FR:"Entrez le message de commit :",ja_JP:"\u30B3\u30DF\u30C3\u30C8\u30E1\u30C3\u30BB\u30FC\u30B8\u3092\u5165\u529B\u3059\u308B\uFF1A",nl_NL:"Typ het vastlegbericht:",zh_CN:"\u8F93\u5165\u63D0\u4EA4\u6D88\u606F\uFF1A"},CMIS_CHECK_OUT:{en_US:"Check Out",de_DE:"Check-Out",fr_FR:"Extraire",ja_JP:"\u30C1\u30A7\u30C3\u30AF\u30A2\u30A6\u30C8",nl_NL:"Uitchecken",zh_CN:"\u9000\u623F"},ERROR_TITLE_:{en_US:"Error",de_DE:"Fehler",fr_FR:"Erreur",ja_JP:"\u30A8\u30E9\u30FC",nl_NL:"Fout",zh_CN:"\u9519\u8BEF"},ERROR_WARN_:{en_US:"Check out failed. Try again or contact your administrator.",de_DE:"Check-Out fehlgeschlagen. Erneut versuchen oder Administrator kontaktieren.",fr_FR:"Extraction \xE9chou\xE9e. R\xE9essayez ou contactez votre administrateur.",ja_JP:"\u30C1\u30A7\u30C3\u30AF\u30A2\u30A6\u30C8\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002\u518D\u8A66\u884C\u3059\u308B\u304B\u3001\u7BA1\u7406\u8005\u306B\u9023\u7D61\u3057\u3066\u304F\u3060\u3055\u3044\u3002",nl_NL:"Uitchecken mislukt. Probeer het opnieuw of neem contact op met de beheerder.",zh_CN:"\u7B7E\u51FA\u5931\u8D25\u3002\u8BF7\u91CD\u8BD5\u6216\u4E0E\u7BA1\u7406\u5458\u8054\u7CFB\u3002"}};sync.Translation.addTranslations(e)})();(function(){goog.events.listen(workspace,sync.api.Workspace.EventType.BEFORE_EDITOR_LOADED,function(e){var t=sync.util.getURLParameter("autoSaveInterval");if(!t){var o=parseInt(sync.options.PluginsOptions.getClientOption("cmis.autosave_interval"));e.options.url.match("cmis")&&(e.options.autoSaveInterval=o)}})})();var a=function(){var e,t=sync.util.getURLParameter("url"),o=sync.options.PluginsOptions.getClientOption("cmis.enforced_url");if(t){var i=decodeURIComponent(t),n=i.substring(a.PROTOCOL_PREFIX.length).indexOf("/")+a.PROTOCOL_PREFIX.length;e=i.substring(0,n)}else o&&(e=a.PROTOCOL_PREFIX+encodeURIComponent(o),o.lastIndexOf("/")!==o.length&&(e+="/"));this.rootUrl_=e,this.rootUrlSet_=!1,this.loginDialog_=null};a.PROTOCOL_PREFIX="cmis://";a.prototype.login=function(e,t){var o=this.getLoginDialog_();o.onSelect(function(n){if(n==="ok"){var s=document.getElementById("cmis-name"),r=s.value.trim(),m=document.getElementById("cmis-passwd"),g=m.value;s.value="",m.value="",goog.net.XhrIo.send("../plugins-dispatcher/cmis-login",function(){localStorage.setItem("cmis.user",r),t&&t()},"POST",goog.Uri.QueryData.createFromMap(new goog.structs.Map({user:r,passwd:g})).toString(),{"X-Requested-With":"g"})}}),o.show();var i=o.getElement().querySelector("#cmis-name");i.value=this.getUserName()||"",i.select()};a.prototype.getLoginDialog_=function(){if(!this.loginDialog_){var e=workspace.createDialog(),t=goog.dom.createDom,o=t("input",{id:"cmis-name",type:"text"});o.setAttribute("autocorrect","off"),o.setAttribute("autocapitalize","none"),o.setAttribute("autofocus",""),o.setAttribute("autocomplete","username");var i=t("input",{id:"cmis-passwd",type:"password"});i.setAttribute("autocomplete","current-password"),goog.dom.appendChild(e.getElement(),t("form","cmis-login-dialog",t("label","",tr(msgs.NAME_)+": ",o),t("label",{style:"margin-top: 10px;"},tr(msgs.PASSWORD_)+": ",i))),e.setTitle(tr(msgs.CONNECT_)),e.setPreferredSize(300,null),this.loginDialog_=e}return this.loginDialog_};a.prototype.getUserName=function(){return localStorage.getItem("cmis.user")};a.prototype.getDefaultRootUrl=function(){return this.rootUrl_};a.prototype.logout=function(e){goog.net.XhrIo.send("../plugins-dispatcher/cmis-login?action=logout",goog.bind(function(){try{localStorage.removeItem("cmis.user")}catch(t){console.warn(t)}e()},this),"POST","",{"X-Requested-With":"g"})};a.prototype.createRootUrlComponent=function(e,t,o){var i=document.createElement("div");return this.rootUrl_?(e||this.rootUrlSet_||(this.rootUrlSet_=!0,setTimeout(goog.bind(function(){t(this.rootUrl_,this.rootUrl_)},this),0)),i.textContent=sync.options.PluginsOptions.getClientOption("cmis.enforced_name")):i.textContent=tr(msgs.SET_CMIS_API_URL_),i};a.prototype.getUrlInfo=function(e,t,o){t(this.rootUrl_,e)};CmisStatus=function(e){this.checkedout_=e.getAttribute("data-pseudoclass-checkedout")==="true",this.locked_=e.getAttribute("data-pseudoclass-locked")==="true",this.supportsCommitMessage_=e.getAttribute("data-pseudoclass-supports-commit-message")==="true",this.oldVersion_=e.getAttribute("data-pseudoclass-oldversion")==="true"};CmisStatus.prototype.setCheckedout=function(e){this.checkedout_=e};CmisStatus.prototype.isOldVersion=function(){return this.oldVersion_};CmisStatus.prototype.isCheckedout=function(){return this.checkedout_};CmisStatus.prototype.setLocked=function(e){this.locked_=e};CmisStatus.prototype.isLocked=function(){return this.locked_};CmisStatus.prototype.supportsCommitMessage=function(){return this.supportsCommitMessage_};var l=function(e,t){sync.actions.AbstractAction.call(this,""),this.editor_=e,this.status_=t,this.dialog_=null};goog.inherits(l,sync.actions.AbstractAction);l.prototype.getDisplayName=function(){return tr(msgs.ALL_VERSIONS_)};l.prototype.getSmallIcon=function(){return sync.util.computeHdpiIcon("../plugin-resources/cmis/icons/ShowVersionHistory16.png")};l.prototype.actionPerformed=async function(e){let t=this.status_.supportsCommitMessage(),o=await workspace.serviceLoader.loadServices(sync.internal_api.DiffApi).then(([r])=>r),i=await workspace.serviceLoader.loadServices(sync.internal_api.DiffTool).then(([r])=>r),n=o&&i;var s=this.getDialog_(t,n);s.show(),s.onSelect((r,m)=>{if(r==="diff"){m.preventDefault();let g=this.getSelectedDiffDocModel_(s.getElement());g.isLeftCurrentVersion?this.showDiffForCurrentEditor_(g,o):this.showDiff_(g,i)}else e()}),this.editor_.getActionsManager().invokeOperation("com.oxygenxml.cmis.web.action.CmisOldVersions",{},goog.bind(this.handleOperationResult_,this,s.getElement(),t,n))};l.prototype.showDiffForCurrentEditor_=function(e,t){let o=new t(this.editor_).withRightLabel(e.rightDocVersion);return(o.canMerge()?o.mergeWith(e.rightDocUrl):o.compareWith(e.rightDocUrl)).catch(n=>{window.workspace.getNotificationManager().showError("Cannot store changes. "+JSON.stringify(n))})};l.prototype.showDiff_=function(e,t){let o=workspace.createDialog();o.show(),o.setTitle(tr(msgs.Diff)),o.setPreferredSize(9e3,9e3);let i=new sync.internal_api.DiffParams(sync.internal_api.DiffType.DIFF,"",e.leftDocUrl);i.rightUrl=e.rightDocUrl,i.leftEditorLabel=e.leftDocVersion,i.rightEditorLabel=e.rightDocVersion,new t(o.getElement()).showDiffEditor(i,{})};l.prototype.getSelectedDiffDocModel_=function(e){let t=e.querySelector("input[name='cmis-diff-left']:checked"),o=e.querySelector("input[name='cmis-diff-right']:checked"),i=t.getAttribute("data-currentversion")==="true",n=t.value,s=t.getAttribute("data-version"),r=o.value,m=o.getAttribute("data-version");return{isLeftCurrentVersion:i,leftDocUrl:n,leftDocVersion:s,rightDocUrl:r,rightDocVersion:m}};l.prototype.getDialog_=function(e,t){var o=this.dialog_;o?goog.dom.removeChildren(o.getElement()):(o=workspace.createDialog(),o.setTitle(tr(msgs.VERSION_HISTORY)),t?o.setButtonConfiguration([{key:"diff",caption:tr(msgs.Diff)},{key:"close",caption:tr(msgs.CLOSE_)}]):o.setButtonConfiguration([{key:"close",caption:tr(msgs.CLOSE_)}]),o.setResizable(!0),this.dialog_=o),e?o.setPreferredSize(750,550):o.setPreferredSize(430,500);var i=document.createElement("div");return i.setAttribute("id","cmis-loader"),o.getElement().appendChild(i),o};l.prototype.handleOperationResult_=function(e,t,o,i,n){document.activeElement.blur(),goog.dom.removeNode(e.querySelector("#cmis-loader"));var s=JSON.parse(n);goog.dom.append(e,this.createTable_(s,t,o));var r=document.querySelector(".current-version");r&&r.scrollIntoView(!1)};l.prototype.createTable_=function(e,t,o){var i=goog.dom.createDom("table","cmis-history-table");let n=goog.dom.createDom("tr","table-header-row",[goog.dom.createDom("th",null,"Version"),goog.dom.createDom("th",null,"Creator")]);if(o&&n.insertBefore(goog.dom.createDom("th",{colspan:2,style:"width:1%"},tr(msgs.Diff)),n.firstChild),t){let d=goog.dom.createDom("th",null,"Check-in Message");n.appendChild(d)}i.appendChild(goog.dom.createDom("thead",null,n));let s=e.findIndex(d=>d.isCurrentVersion==="true"),r=Math.max(s,0),m=Math.min(r+1,e.length-1);for(let d=0;d<e.length;d++){let c=e[d];var g=c.url,_=c.isCurrentVersion==="true",C=window.location.origin+window.location.pathname+"?url="+encodeURIComponent(g),v=goog.dom.createDom("a",{className:"cmis-old-version-link",href:_?"#":C,target:"_blank"},c.version),y=goog.dom.createDom("td","cmis-version",v),E=goog.dom.createDom("td",{class:"cmis-user",title:c.author},c.author),h=goog.dom.createDom("tr",{className:_?"current-version":"",title:_?"Opened document version":""},y,E);if(o){var D=goog.dom.createDom("td","cmis-diff-left",goog.dom.createDom("input",{type:"radio",name:"cmis-diff-left",value:g,title:tr(msgs.LEFT_DIFF_DOC),checked:r===d,"data-version":c.version,"data-currentversion":c.isCurrentVersion})),p=goog.dom.createDom("td","cmis-diff-right",goog.dom.createDom("input",{type:"radio",name:"cmis-diff-right",value:g,title:tr(msgs.RIGHT_DIFF_DOC),checked:m===d,"data-version":c.version,"data-currentversion":c.isCurrentVersion}));h.insertBefore(p,h.firstChild),h.insertBefore(D,p)}if(t){var S=c.commitMessage.replace(`/
`,"&#10;"),k=goog.dom.createDom("td","cmis-checkin-message",goog.dom.createDom("span",{title:S},c.commitMessage));h.appendChild(k)}i.appendChild(h)}return i};cancelCmisCheckOutAction=function(e,t){sync.actions.AbstractAction.call(this,""),this.editor_=e,this.status_=t,this.dialog_=null};goog.inherits(cancelCmisCheckOutAction,sync.actions.AbstractAction);cancelCmisCheckOutAction.prototype.getDisplayName=function(){return tr(msgs.CMIS_CANCEL_CHECK_OUT)};cancelCmisCheckOutAction.prototype.getSmallIcon=function(){return sync.util.computeHdpiIcon("../plugin-resources/cmis/icons/DiscardCheckOut16.png")};cancelCmisCheckOutAction.prototype.isEnabled=function(){return this.status_.isCheckedout()};cancelCmisCheckOutAction.prototype.actionPerformed=function(e){if(!this.dialog_){var t=workspace.createDialog();t.setTitle(tr(msgs.CMIS_CANCEL_CHECK_OUT)),t.setButtonConfiguration([{key:"discard",caption:tr(msgs.CMIS_CANCEL_CHECK_OUT)},{key:"cancel",caption:tr(msgs.CANCEL_)}]),goog.dom.append(t.getElement(),goog.dom.createDom("div","cmis-error-content",tr(msgs.CMIS_LOSE_CHANGES_),goog.dom.createDom("br"),tr(msgs.CMIS_CANCEL_WARNING_))),this.dialog_=t}this.dialog_.show(),this.dialog_.onSelect(goog.bind(function(o,i){o==="discard"?this.revertDocument_().then(()=>this.save_()).then(()=>this.discardPwc_()).thenAlways(e):goog.isFunction(e)&&e()},this))};cancelCmisCheckOutAction.prototype.revertDocument_=function(){let e=this.editor_.getActionsManager();return sync.util.promise.promisify(e.invokeOperation,e)("com.oxygenxml.cmis.web.action.RevertDocumentOpereation",{})};cancelCmisCheckOutAction.prototype.save_=function(){return sync.util.promise.promisify(this.editor_.triggerSave,this.editor_)()};cancelCmisCheckOutAction.prototype.discardPwc_=function(){this.status_.setCheckedout(!1);let e=this.editor_.getActionsManager();return sync.util.promise.promisify(e.invokeOperation,e)("com.oxygenxml.cmis.web.action.DiscardCheckOutOperation",{})};CmisCheckInAction=function(e,t){sync.actions.AbstractAction.call(this,""),this.editor_=e,this.status_=t,this.dialog_=null};goog.inherits(CmisCheckInAction,sync.actions.AbstractAction);CmisCheckInAction.prototype.getDisplayName=function(){return tr(msgs.CMIS_CHECK_IN)};CmisCheckInAction.prototype.getSmallIcon=function(){return sync.util.computeHdpiIcon("../plugin-resources/cmis/icons/CheckIn16.png")};CmisCheckInAction.prototype.isEnabled=function(){return this.status_.isCheckedout()};CmisCheckInAction.prototype.actionPerformedInternal_=function(e){if(this.editor_.isDirty()){this.editor_.problemReporter.showWarning(tr(msgs.SAVE_CHANGES_BEFORE_CHECK_IN_));return}var t=this.getDialog_(this.status_.supportsCommitMessage());t.show(),t.onSelect(goog.bind(this.handleDialogSelect_,this,e))};CmisCheckInAction.prototype.getDialog_=function(e){var t=this.dialog_;t||(t=workspace.createDialog(),t.setTitle(tr(msgs.CMIS_CHECK_IN)),this.dialog_=t);var o=t.getElement();return o.innerHTML="",e&&goog.dom.append(o,this.createCommitMessageElements_()),t.setContentPreferredSize(253,null),o.appendChild(this.createVersionForm_()),t};CmisCheckInAction.prototype.handleDialogSelect_=function(e,t,o){if(t==="ok"){var i=this.dialog_.getElement(),n=i.querySelector("#cmis-commit-message"),s=n?n.value.replace(/["']/g,""):null,r=i.querySelector('.cmis-version-label input[type="radio"]:checked');this.editor_.getActionsManager().invokeOperation("com.oxygenxml.cmis.web.action.CmisCheckIn",{commit:s,state:r?r.value:""},e),this.status_.setCheckedout(!1)}else goog.isFunction(e)&&e()};CmisCheckInAction.prototype.actionPerformed=function(e){if(this.editor_.isDirty()){var t=this.editor_.getActionsManager().getActionById("Author/Save");t.actionPerformed(goog.bind(this.actionPerformedInternal_,this,e))}else this.actionPerformedInternal_(e)};CmisCheckInAction.prototype.createVersionForm_=function(){var e=goog.dom.createDom,t=e("input",{type:"radio",name:"state",value:"major"}),o=e("input",{type:"radio",name:"state",value:"minor"});return o.setAttribute("checked",""),e("form","",e("label","cmis-version-label",t,tr(msgs.MAJOR_VERSION_)),e("label","cmis-version-label",o,tr(msgs.MINOR_VERSION_)))};CmisCheckInAction.prototype.createCommitMessageElements_=function(){return[goog.dom.createDom("div","",tr(msgs.CHECK_IN_MESSAGE_)),goog.dom.createDom("textarea",{id:"cmis-commit-message",style:"margin:0px; width:255px; height:125px; resize:none;",type:"text"})]};var u=function(e,t){sync.actions.AbstractAction.call(this,""),this.editor_=e,this.status_=t,this.dialog_=null};goog.inherits(u,sync.actions.AbstractAction);u.prototype.getDisplayName=function(){return tr(msgs.CMIS_CHECK_OUT)};u.prototype.getSmallIcon=function(){return sync.util.computeHdpiIcon("../plugin-resources/cmis/icons/CheckOut16.png")};u.prototype.isEnabled=function(){return!this.status_.isCheckedout()&&!this.status_.isOldVersion()};u.prototype.actionPerformed=function(e){this.editor_.getActionsManager().invokeOperation("com.oxygenxml.cmis.web.action.CmisCheckOut",{},goog.bind(this.handleOperationResult_,this,e))};u.prototype.handleOperationResult_=function(e,t,o){if(o===null){goog.isFunction(e)&&e();return}var i=JSON.parse(o);i.error==="denied"?(this.status_.setCheckedout(!1),this.createErrorDialog_(350,300),this.appendErrorMessageWithWarning_(t,i),this.dialog_.show()):i.error==="checked_out_by"?(this.status_.setCheckedout(!1),this.createErrorDialog_(350,200),this.appendErrorMessage_(t,i),this.dialog_.show()):this.status_.setCheckedout(!0)};u.prototype.createErrorDialog_=function(e,t){this.dialog_?goog.dom.removeChildren(this.dialog_.getElement()):(this.dialog_=workspace.createDialog(),this.dialog_.setTitle(tr(msgs.ERROR_TITLE_)),this.dialog_.setButtonConfiguration(sync.api.Dialog.ButtonConfiguration.OK),this.dialog_.setPreferredSize(e,t))};u.prototype.appendErrorMessageWithWarning_=function(e,t){this.appendWarning_(),this.appendErrorMessage_(e,t)};u.prototype.appendErrorMessage_=function(e,t){var o=e?e.message:t.message;goog.dom.append(this.dialog_.getElement(),goog.dom.createDom("div",{id:"cmis-messdiv"},o))};u.prototype.appendWarning_=function(){goog.dom.append(this.dialog_.getElement(),goog.dom.createDom("div","warningdiv",tr(msgs.ERROR_WARN_)),goog.dom.createDom("hr",{id:"cmis-warnhr"}))};var O=sync.options.PluginsOptions.getClientOption("cmis.has_service_account")==="true",f={id:"cmis",name:sync.options.PluginsOptions.getClientOption("cmis.enforced_name"),icon:sync.util.computeHdpiIcon(sync.options.PluginsOptions.getClientOption("cmis.enforced_icon")),matches:function(t){return t.match(a.PROTOCOL_PREFIX)},fileServer:new a};workspace.getFileServersManager().registerFileServerConnector(f);goog.events.listen(workspace,sync.api.Workspace.EventType.EDITOR_LOADED,function(e){var t=e.editor;if(t.getUrl().indexOf(a.PROTOCOL_PREFIX)===0){var o=document.querySelector('[data-root="true"]'),i=o.getAttribute("data-pseudoclass-nonversionable");i!=="true"&&A(t,new CmisStatus(o))}});function A(e,t){var o=e.getActionsManager();o.registerAction("cmisCheckOut.link",new u(e,t)),o.registerAction("cancelCmisCheckOut.link",new cancelCmisCheckOutAction(e,t)),o.registerAction("cmisCheckIn.link",new CmisCheckInAction(e,t)),o.registerAction("listOldVersion.link",new l(e,t)),goog.events.listen(e,sync.api.Editor.EventTypes.ACTIONS_LOADED,function(i){var n=i.actionsConfiguration.toolbars;if(O&&i.actionsConfiguration.removeAction("cmis/Logout"),!!n)for(var s=0;s<n.length;s++){var r=n[s];r.name==="Builtin"&&r.children.push({displayName:f.name,type:"list",name:"cmis-actions",children:[{id:"listOldVersion.link",type:"action"},{id:"cmisCheckOut.link",type:"action"},{id:"cmisCheckIn.link",type:"action"},{id:"cancelCmisCheckOut.link",type:"action"}]})}})}})();
