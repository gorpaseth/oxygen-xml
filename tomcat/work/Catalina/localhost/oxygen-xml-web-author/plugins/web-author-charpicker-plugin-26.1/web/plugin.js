sync.Translation.addTranslations({MORE_SYMBOLS_:{en_US:"More symbols",de_DE:"Mehr Symbole",fr_FR:"Plus de symboles",ja_JP:"さらに多くのシンボル",nl_NL:"Meer symbolen",zh_CN:"更多符号"},INSERT_SPECIAL_CHARACTERS_:{en_US:"Insert special characters",de_DE:"Sonderzeichen einfügen",fr_FR:"Insérer des caractère spéciaux",ja_JP:"特殊文字を挿入する",nl_NL:"Speciale tekens invoegen",zh_CN:"插入特殊字符"},BY_CATEGORIES_OR_HEX_CODE_:{en_US:"By categories or hex code",de_DE:"Nach Kategorien oder Hex-Codes",fr_FR:"Par catégories ou code hexadécimal",ja_JP:"分類項目または16進数コードによる",nl_NL:"Op categorie of hexadecimale code",zh_CN:"按类别或十六进制代码"},BY_CATEGORIES_:{en_US:"By categories",de_DE:"Nach Kategorien",fr_FR:"Par catégories",ja_JP:"カテゴリによる",nl_NL:"Op categorie",zh_CN:"按类别"},BY_NAME_:{en_US:"By name",de_DE:"Nach Namen",fr_FR:"Par nom",ja_JP:"名前による",nl_NL:"Op naam",zh_CN:"按姓名"},NAME_OF_CHARACTER_:{en_US:"Name of character to search for:",de_DE:"Name des Zeichens, nach dem gesucht werden soll:",fr_FR:"Nom du caractère à rechercher :",ja_JP:"検索するための文字の名前：",nl_NL:"Naam van teken waarnaar u wilt zoeken:",zh_CN:"搜索的字符名："},SELECTED_CHARACTERS_:{en_US:"Selected characters:",de_DE:"Ausgewählte Zeichen:",fr_FR:"Caractères sélectionnés :",ja_JP:"選択された文字：",nl_NL:"Geselecteerde tekens:",zh_CN:"选定字符："},NO_RESULTS_FOUND_:{en_US:"No results found",de_DE:"Keine Ergebnisse gefunden",fr_FR:"Aucun résultat n'a été trouvé",ja_JP:"ひとつも見つかりません",nl_NL:"Geen resultaten gevonden",zh_CN:"未找到结果"},REMOVE_LAST_CHARACTER_:{en_US:"Remove last character",de_DE:"Letztes Zeichen entfernen",fr_FR:"Supprimer le dernier caractère",ja_JP:"最後の文字を削除する",nl_NL:"Laatste teken verwijderen",zh_CN:"删除最后一个字符"}});var localStorageUsable="undefined"!=typeof Storage,insertSpecialCharActionId="insertfrommenu",maxRecentChars=21,recentCharsItemName="recentlyUsedCharacters",usedCharsItemName="usedCharacters",usedCharsItemTitles="usedCharactersTitles",defaultRecentCharacters=["€","£","¥","¢","©","®","™","α","β","π","μ","Σ","Ω","≤","≥","≠","∞","±","÷","×","⇒"],readOnlyInputId="special_characters";function addNewRecentCharacters(e){var t=window.charsToBeInsertedTitles||{},e=e.concat(getCharListFromStorage(usedCharsItemName)),t=Object.assign(t,getUsedCharsTitles());goog.array.removeDuplicates(e),setRecentChars(e=e.slice(0,maxRecentChars),t)}function getUsedCharsMigration(t,e){var r=[];if(e.length&&!goog.array.equals(t,e))for(var o=goog.array.map(e,function(e){return t.indexOf(e)}),n=0;n<e.length;n++){var a=o.indexOf(n),i=e[n];if(-1!==a){a=o.slice(n);if(-1===a.indexOf(-1)&&goog.array.isSorted(a,null,!0))break}r.push(i)}return r}function getUserSelectedDefaults(){var e=[];try{var t,e=JSON.parse(sync.options.PluginsOptions.getClientOption("charp.recently.used.characters"));goog.isArray(e)&&(t=[],goog.array.forEach(e,function(e){t.push(String.fromCodePoint&&String.fromCodePoint(e)||String.fromCharCode(e))}),e=t)}catch(e){console.error("Failed to parse default recently used characters",e)}return e}function setRecentChars(e,t){if(localStorageUsable)try{localStorage.setItem(usedCharsItemName,JSON.stringify(e)),t&&localStorage.setItem(usedCharsItemTitles,JSON.stringify(t))}catch(e){console.warn(e)}}function getDefaultRecentChars(){return getUserSelectedDefaults().concat(defaultRecentCharacters)}function getRecentChars(){var e,t=getCharListFromStorage(usedCharsItemName);return 0===t.length&&(e=getCharListFromStorage(recentCharsItemName),(t=getUsedCharsMigration(defaultRecentCharacters,e)).length)&&addNewRecentCharacters(t,{}),t.length<maxRecentChars&&(t=t.concat(getDefaultRecentChars()),goog.array.removeDuplicates(t)),t=t.slice(0,maxRecentChars)}function getCharListFromStorage(e){e=getObjectFromLocalStorage(e);return e||[]}function getUsedCharsTitles(){var e=getObjectFromLocalStorage(usedCharsItemTitles);return e||{}}function getObjectFromLocalStorage(e){e=getFromLocalStorage(e);if(e)try{e=JSON.parse(e)}catch(e){console.warn(e)}return e}function getFromLocalStorage(e){var t=null;try{t=localStorage.getItem(e)}catch(e){console.warn(e)}return t}var RecentCharactersGrid=function(e,t){goog.ui.PopupMenu.call(this),this.actLikeDropdown_(),this.addMoreSymbolsButton_(e),this.render(),goog.dom.setProperties(this.getElement(),{id:"pickermenu"}),this.insertCharacters_=t,this.addGridContainer_()};function InsertFromMenuAction(e){sync.actions.Action.call(this,{description:tr(msgs.INSERT_SPECIAL_CHARACTERS_),displayName:"insert from menu"}),this.editor_=e,this.timeoutFunction_=null,this.pluginResourcesFolder_="char-picker",this.tabSelectedClass_="charp-show",this.lastCharacterSearchItemName_="lastCharacterSearch"}function getReadOnlyInput(){var e=goog.dom.createDom("input",{id:readOnlyInputId,className:"charpicker-input",type:"text",name:"charsToBeInserted"});return e.setAttribute("readonly","true"),e.setAttribute("onFocus","this.setSelectionRange(0, this.value.length)"),e}function getRemoveLastCharButton(){return goog.dom.createDom("button",{id:"removeLastChar",className:"goog-button goog-char-picker-okbutton",title:tr(msgs.REMOVE_LAST_CHARACTER_),value:""})}function getNameInput(){return goog.dom.createDom("input",{id:"searchName",className:"charpicker-input",type:"text",name:"searchName"})}function updateCharPreviewInternal(e){var e=e.target,t=e.textContent,r=e.getAttribute("data-symbol-hexcode"),e=e.getAttribute("data-symbol-name"),o=document.getElementById("previewCharacterDetails");goog.dom.removeChildren(o),goog.dom.append(o,goog.dom.createDom("div",{id:"previewSymbol"},t),goog.dom.createDom("div",{id:"previewSymbolName"},e,goog.dom.createDom("span",{style:"white-space: nowrap; vertical-align: top"}," ("+r+")")))}function updateCharPreview(e){var t;goog.dom.classlist.contains(e.target,"characterListSymbol")&&(updateCharPreviewInternal(e),e.type===goog.events.EventType.CLICK)&&(t=e.target.textContent,charsToBeInserted.push(t),(e=e.target.getAttribute("data-symbol-name"))&&(charsToBeInsertedTitles["'"+t+"'"]=e),(e=document.getElementById(readOnlyInputId)).value+=t,e.focus())}goog.inherits(RecentCharactersGrid,goog.ui.PopupMenu),RecentCharactersGrid.prototype.addMoreSymbolsButton_=function(e){var t=new goog.ui.MenuItem(tr(msgs.MORE_SYMBOLS_)+"...");this.addChild(t,!0),t.setId("moreSymbolsButton"),goog.events.listen(t,goog.ui.Component.EventType.ACTION,e)},RecentCharactersGrid.prototype.actLikeDropdown_=function(){this.charPickerToolbarButton_||(this.charPickerToolbarButton_=document.querySelector("[name="+insertSpecialCharActionId+"]"));var t=goog.ui.Component.EventType;goog.events.listen(this,[t.SHOW,t.HIDE],e=>{this.charPickerToolbarButton_.classList.toggle("goog-toolbar-menu-button-open",e.type===t.SHOW)}),this.setToggleMode(!0)},RecentCharactersGrid.prototype.handleBlur=goog.nullFunction,RecentCharactersGrid.prototype.addGridContainer_=function(){var e=this.getElement(),t=e.firstChild;this.recentCharactersGrid_=goog.dom.createDom("div",{className:"goog-char-picker-grid recentCharactersGrid",id:"simplePickerGrid"}),goog.events.listen(this.recentCharactersGrid_,goog.events.EventType.CLICK,this.quickInsertCharFromGrid_.bind(this)),e.insertBefore(this.recentCharactersGrid_,t)},RecentCharactersGrid.prototype.showRecentGrid=function(){var e=getRecentChars();this.displayRecentCharacters_(e),this.showAtElement(this.charPickerToolbarButton_,goog.positioning.Corner.BOTTOM_START)},RecentCharactersGrid.prototype.getToolTip_=function(e){var t="U+"+e.codePointAt(0).toString(16).toUpperCase(),r=t,o=localStorage.getItem("usedCharactersTitles");return r=o&&(o=JSON.parse(o)["'"+e+"'"])?o+" ("+t+")":r},RecentCharactersGrid.prototype.displayRecentCharacters_=function(e){goog.dom.removeChildren(this.recentCharactersGrid_);for(var t of e){var r=this.getToolTip_(t);this.recentCharactersGrid_.appendChild(goog.dom.createDom("div",{className:"goog-inline-block goog-flat-button char-select-button",tabIndex:0,title:r},t))}},RecentCharactersGrid.prototype.quickInsertCharFromGrid_=function(e){goog.dom.classlist.contains(e.target,"goog-flat-button")&&this.insertCharacters_([e.target.textContent])},goog.inherits(InsertFromMenuAction,sync.actions.Action),InsertFromMenuAction.prototype.isEnabled=function(){return!sync.util.isInReadOnlyContent.apply(this.editor_.getSelectionManager().getSelection())&&!this.editor_.getReadOnlyState().readOnly},InsertFromMenuAction.prototype.actionPerformed=function(e){var t=this.csmenu_;t.isOrWasRecentlyVisible()?t.hide():t.showRecentGrid(),e&&e()},InsertFromMenuAction.prototype.insertCharacters_=function(t){var e=this.editor_.getEditingSupport().actionsExecutor,r=this.editor_.getActionsManager();e.executeAction(new sync.actions.Action({execute:()=>new Promise(e=>{r.invokeOperation("ro.sync.ecss.extensions.commons.operations.InsertOrReplaceTextOperation",{text:t.join("")},function(){addNewRecentCharacters(t.splice(0).reverse()),e(t)})})}))},InsertFromMenuAction.prototype.init=function(){window.charsToBeInserted=[],window.charsToBeInsertedTitles={},this.csmenu_=new RecentCharactersGrid(this.displayDialog_.bind(this),this.insertCharacters_.bind(this))},InsertFromMenuAction.prototype.getCategoriesToRemove=function(){return sync.options.PluginsOptions.getClientOption("charp.remove_categories")},InsertFromMenuAction.prototype.isCategoriesTabEnabled=function(){var e=this.getCategoriesToRemove();return!e||-1===e.indexOf("*")},InsertFromMenuAction.prototype.renderByCategoriesTab=function(){return this.isCategoriesTabEnabled()?goog.dom.createDom("div",{className:"goog-tab","data-target-id":"charpicker-advanced"},goog.dom.createDom("span",{title:tr(msgs.BY_CATEGORIES_OR_HEX_CODE_)},tr(msgs.BY_CATEGORIES_))):null},InsertFromMenuAction.prototype.renderByCategoriesTabContent=function(){var e;return this.isCategoriesTabEnabled()&&(e=goog.dom.createDom("div",{id:"charpicker-advanced"}),this.charPickerIframe_=goog.dom.createDom("iframe",{id:"charpickeriframe",src:this.getIframeUrl_()}),e.appendChild(this.charPickerIframe_)),e},InsertFromMenuAction.prototype.createCharPickerDialog_=function(){var e,t,r,o,n=goog.dom.createDom;this.foundByNameList_||(this.nameInput_=getNameInput(),this.foundByNameList_=n("div",{id:"foundByNameList",tabIndex:0,role:"grid"}),t="goog-tab-bar goog-tab-bar-top",this.isCategoriesTabEnabled()||(t+=" no-categories"),t=n("div",{style:"display: flex; flex-direction: column; flex-grow: 1; min-height: 0;"},n("div",{id:"charp-tabbar",className:t},n("div",{className:"goog-tab goog-tab-selected","data-target-id":"charpicker-search-by-name"},tr(msgs.BY_NAME_)),this.renderByCategoriesTab()),n("div",{id:"charp-tabbar-content"},n("div",{id:"charpicker-search-by-name",className:this.tabSelectedClass_},n("div",{style:"line-height: 1.2em; height: 57px; flex-shrink: 0;"},n("label",{for:"searchName",style:"white-space: nowrap"},tr(msgs.NAME_OF_CHARACTER_)),this.nameInput_),this.foundByNameList_,n("div",{id:"previewCharacterDetails"})),this.renderByCategoriesTabContent())),(o=(e=this.getDialog()).getElement()).id="charPicker",goog.dom.appendChild(o,t),this.isCategoriesTabEnabled()&&((t=new goog.ui.TabBar).decorate(document.querySelector("#charp-tabbar")),goog.events.listen(t,goog.ui.Component.EventType.SELECT,goog.bind(this.selectTab_,this))),o.parentElement.classList.add("dialogContainer"),t=goog.events.EventType,goog.events.listen(this.foundByNameList_,[t.MOUSEOVER,t.CLICK],updateCharPreview),goog.events.listen(this.nameInput_,t.KEYDOWN,goog.bind(this.findCharOnEnter_,this)),goog.events.listen(this.nameInput_,t.INPUT,goog.bind(this.findCharAfterInput_,this)),r=getReadOnlyInput(),o=getRemoveLastCharButton(),n=n("div",{id:"selectedCharsWrapper"},n("label",{style:"display: inline-block; margin-right:10px;",for:readOnlyInputId},tr(msgs.SELECTED_CHARACTERS_)),n("span",{style:"display: inline-flex; white-space: nowrap;"},r,o)),goog.dom.appendChild(e.getElement(),n),r.scrollTop=r.scrollHeight,goog.events.listen(o,t.CLICK,function(){r.value="",charsToBeInserted.pop();for(var e of charsToBeInserted)r.value+=e;r.focus()}),this.readOnlyInput_=r)},InsertFromMenuAction.prototype.selectTab_=function(e){e=e.target.getElement(),e=goog.dom.dataset.get(e,"targetId");if(e){var t,e=goog.dom.getElement(e);for(t of document.querySelectorAll("."+this.tabSelectedClass_))goog.dom.classlist.remove(t,this.tabSelectedClass_);goog.dom.classlist.add(e,this.tabSelectedClass_)}},InsertFromMenuAction.prototype.charPickerDialogOnSelect_=function(e){"ok"===e&&(e=window.charsToBeInserted)&&this.insertCharacters_(e)},InsertFromMenuAction.prototype.displayDialog_=function(){window.charsToBeInserted=[],window.charsToBeInsertedTitles={},this.foundByNameList_?this.refreshCharPickerDialog_():this.createCharPickerDialog_(),this.dialog_.onSelect(goog.bind(this.charPickerDialogOnSelect_,this)),this.dialog_.show()},InsertFromMenuAction.prototype.refreshCharPickerDialog_=function(){this.readOnlyInput_.value="",this.setLastSearchAsPlaceholder_(),this.removeWarningFromLastSearch_(),this.resetHexInput_()},InsertFromMenuAction.prototype.setLastSearchAsPlaceholder_=function(){var e=this.dialog_.getElement().querySelector("#searchName"),t=(e.value="",getFromLocalStorage(this.lastCharacterSearchItemName_));null!==t&&e.setAttribute("placeholder",t)},InsertFromMenuAction.prototype.removeWarningFromLastSearch_=function(){var e=this.dialog_.getElement().querySelector(".smallSpin");e&&goog.dom.removeNode(e)},InsertFromMenuAction.prototype.resetHexInput_=function(){var e;this.charPickerIframe_&&((e=this.charPickerIframe_.contentWindow||this.charPickerIframe_.contentDocument).document?(e=e.document).querySelector(".goog-char-picker-input-box").value="":console.warn("Failed to get iframe contents."))},InsertFromMenuAction.prototype.afterSearchByName_=function(e,t,r){var o=r.target.getResponseJson(),n="{}"===JSON.stringify(o);if(e.hide(),n){t.textContent=tr(msgs.NO_RESULTS_FOUND_);try{localStorage.removeItem(this.lastCharacterSearchItemName_)}catch(r){console.warn(r)}}else{this.refreshSymbols_(o);try{localStorage.setItem(this.lastCharacterSearchItemName_,this.nameInput_.value)}catch(r){console.warn(r)}}},InsertFromMenuAction.prototype.refreshSymbols_=function(e){for(var t in goog.dom.removeChildren(this.foundByNameList_),e)e.hasOwnProperty(t)&&this.renderSymbolCard_(this.foundByNameList_,t,e[t])},InsertFromMenuAction.prototype.renderSymbolCard_=function(e,t,r){e.appendChild(goog.dom.createDom("div",{className:"characterListSymbol","data-symbol-name":this.capitalizeWords_(r),"data-symbol-hexcode":t},String.fromCharCode(parseInt(t,16))))},InsertFromMenuAction.prototype.capitalizeWords_=function(e){var t,r=[];for(t of e.toLowerCase().split(" "))r.push(t.substr(0,1).toUpperCase()+t.substring(1));return r.join(" ")},goog.require("goog.net.XhrIo"),InsertFromMenuAction.prototype.findCharByName_=function(){var e,t,r=this.nameInput_.value;this.dialog_.getElement().querySelector("#searchName").removeAttribute("placeholder"),goog.dom.removeChildren(this.foundByNameList_),goog.dom.removeChildren(document.getElementById("previewCharacterDetails")),0!==r.length&&(e=goog.dom.createDom("div",{className:"smallSpin",style:"text-align:center; width: 100%; left: 0;"}),this.foundByNameList_.appendChild(e),(t=new sync.view.Spinner(e,1,"iframeSpinner")).show(),r="../plugins-dispatcher/charpicker-plugin?q="+encodeURIComponent(r),goog.net.XhrIo.send(r,goog.bind(this.afterSearchByName_,this,t,e),"GET"))},InsertFromMenuAction.prototype.getDialog=function(){return this.dialog_||(this.dialog_=workspace.createDialog(),this.dialog_.setTitle(tr(msgs.INSERT_SPECIAL_CHARACTERS_)),this.dialog_.setPreferredSize(420,600),this.dialog_.setResizable(!0)),this.dialog_},InsertFromMenuAction.prototype.dispose=function(){this.dialog_&&this.dialog_.dispose(),this.csmenu_&&this.csmenu_.dispose()},InsertFromMenuAction.prototype.findCharOnEnter_=function(e){13===e.keyCode&&(e.preventDefault(),clearTimeout(this.timeoutFunction_),this.findCharByName_())},InsertFromMenuAction.prototype.findCharAfterInput_=function(){clearTimeout(this.timeoutFunction_),this.timeoutFunction_=setTimeout(goog.bind(this.findCharByName_,this),500)},InsertFromMenuAction.prototype.getIframeUrl_=function(){var e="../plugin-resources/"+this.pluginResourcesFolder_+"/charpicker.html",t=this.getCategoriesToRemove();return t&&(e+="?remove-categories="+encodeURIComponent(t)),e},InsertFromMenuAction.prototype.getLargeIcon=function(){return sync.util.computeHdpiIcon("../plugin-resources/"+this.pluginResourcesFolder_+"/InsertFromCharactersMap24.png")},goog.events.listen(workspace,sync.api.Workspace.EventType.BEFORE_EDITOR_LOADED,function(e){var r,e=e.editor,o=new InsertFromMenuAction(e),n=(e.getActionsManager().registerAction(insertSpecialCharActionId,o),0);r=e,goog.events.listen(r,sync.api.Editor.EventTypes.ACTIONS_LOADED,function(e){var t;r.getEditorType()===sync.api.Editor.EditorTypes.AUTHOR&&function(e){e=e.actionsConfiguration.toolbars;return e&&!e.find(e=>"Review"===e.name||"Builtin"===e.name)}(e)&&(e=e.actionsConfiguration.toolbars[0],(t=e)&&t.children.find(e=>e.id===insertSpecialCharActionId)&&n++,e)&&0===n&&(n++,e.children.push({id:insertSpecialCharActionId,type:"action"}),setTimeout(function(){o.init()},0))})});