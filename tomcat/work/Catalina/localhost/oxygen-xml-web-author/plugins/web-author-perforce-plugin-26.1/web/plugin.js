(()=>{(function(){var e={CHECK_OUT_:{en_US:"Check out",de_DE:"Check-Out",fr_FR:"Extraire",ja_JP:"\u30C1\u30A7\u30C3\u30AF\u30A2\u30A6\u30C8",nl_NL:"Uitchecken",zh_CN:"\u7B7E\u51FA"},BACKUP_DELETED_NOTIFICATION_:{en_US:"Backup deleted.",de_DE:"Sicherung gel\xF6scht.",fr_FR:"Copie de sauvegarde supprim\xE9e.",ja_JP:"\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u304C\u524A\u9664\u3055\u308C\u307E\u3057\u305F\u3002",nl_NL:"Back-up verwijderd.",zh_CN:"\u5907\u4EFD\u5DF2\u5220\u9664\u3002"},BACKUP_DELETE_FAILED_:{en_US:"Failed to delete backup.",de_DE:"Konnte Backup nicht l\xF6schen.",fr_FR:"\xC9chec de la suppression de la copie de sauvegarde.",ja_JP:"\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u3092\u524A\u9664\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002",nl_NL:"Verwijderen van back-up is mislukt.",zh_CN:"\u65E0\u6CD5\u5220\u9664\u5907\u4EFD\u3002"},FILE_SHELVED_ERROR_:{en_US:"Backup failed.",de_DE:"Sicherung fehlgeschlagen.",fr_FR:"Copie de sauvegarde \xE9chou\xE9e.",ja_JP:"\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002",nl_NL:"Maken van back-up is mislukt.",zh_CN:"\u5907\u4EFD\u5931\u8D25\u3002"},BACKUP_FOUND_DIALOG_TITLE_:{en_US:"Backup found",de_DE:"Sicherung gefunden",fr_FR:"Copie de sauvegarde trouv\xE9e",ja_JP:"\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u304C\u898B\u3064\u304B\u308A\u307E\u3057\u305F",nl_NL:"Back-up gevonden",zh_CN:"\u627E\u5230\u5907\u4EFD"},OPEN_BACKUP_:{en_US:"Open from backup",de_DE:"\xD6ffne aus der Sicherung",fr_FR:"Ouvrir depuis la copie de sauvegarde",ja_JP:"\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u304B\u3089\u958B\u304F",nl_NL:"Openen vanuit back-up",zh_CN:"\u4ECE\u5907\u4EFD\u6253\u5F00"},DELETE_BACKUP_:{en_US:"Continue",de_DE:"Weiter",fr_FR:"Continuer",ja_JP:"\u7D9A\u3051\u308B",nl_NL:"Ga door",zh_CN:"\u7EE7\u7EED"},BACKUP_FOUND_DIALOG_MSG_:{en_US:"A backup copy of this document exists in the repository.{$LINE_BREAK}What do you want to do?",de_DE:"Eine Sicherungskopie dieses Dokuments existiert im Repository.{$LINE_BREAK}Was m\xF6chten Sie tun?",fr_FR:"Une copie de sauvegarde de ce document existe dans le d\xE9p\xF4t.{$LINE_BREAK}Que voulez-vous faire?",ja_JP:"\u3053\u306E\u30C9\u30AD\u30E5\u30E1\u30F3\u30C8\u306E\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u306F\u3001\u30EA\u30DD\u30B8\u30C8\u30EA {$LINE_BREAK} \u306B\u5B58\u5728\u3057\u307E\u3059\u3002\u3069\u3046\u3057\u307E\u3059\u304B?",nl_NL:"Er bestaat een back-upexemplaar van dit document in de opslagplaats.{$LINE_BREAK}Wat wilt u doen?",zh_CN:"\u6B64\u6587\u6863\u7684\u5907\u4EFD\u526F\u672C\u5B58\u5728\u4E8E\u5B58\u50A8\u5E93\u4E2D\u3002{$LINE_BREAK}\u60A8\u60F3\u505A\u4EC0\u4E48\uFF1F"},PERFORCE_NOT_CONFIGURED_:{en_US:"Perforce plugin configuration is not complete. Go to the {$ADMINISTRATION_PAGE} to complete the configuration.",de_DE:"Konfiguration des Perforce-Plugins ist unvollst\xE4ndig. \xD6ffnen Sie die {$ADMINISTRATION_PAGE}, um die Konfiguration abzuschlie\xDFen.",fr_FR:"La configuration du plugin Perforce est incompl\xE8te. Allez \xE0 {$ADMINISTRATION_PAGE} pour compl\xE9ter la configuration.",ja_JP:"Perforce \u30D7\u30E9\u30B0\u30A4\u30F3\u69CB\u6210\u304C\u5B8C\u6210\u3057\u3066\u3044\u307E\u305B\u3093\u3002{$ADMINISTRATION_PAGE} \u306B\u9032\u3093\u3067\u3001\u69CB\u6210\u3092\u5B8C\u6210\u3055\u305B\u3066\u304F\u3060\u3055\u3044\u3002",nl_NL:"Configuratie van Perforce-plug-in is niet voltooid. Ga naar de {$ADMINISTRATION_PAGE} om de configuratie te voltooien.",zh_CN:"\u6027\u80FD\u63D2\u4EF6\u914D\u7F6E\u672A\u5B8C\u6210\u3002\u8F6C\u5230{$ADMINISTRATION_PAGE}\u9875\u9762\u5B8C\u6210\u914D\u7F6E\u3002"},ADMINISTRATION_PAGE_:{en_US:"Administration Page",de_DE:"Administrationsseite",fr_FR:"Page d'administration",ja_JP:"\u7BA1\u7406\u30DA\u30FC\u30B8",nl_NL:"Beheerpagina",zh_CN:"\u7BA1\u7406\u9875\u9762"},CONNECT_:{en_US:"Connect",de_DE:"Verbinden",fr_FR:"Connexion",ja_JP:"\u63A5\u7D9A\u3059\u308B",nl_NL:"Verbinden",zh_CN:"\u8FDE\u63A5"},CONNECT_TO_ACCESS_:{en_US:"You must connect to access {$URL}",de_DE:"Sie m\xFCssen sich verbinden, um auf {$URL} zuzugreifen",fr_FR:"Vous devez vous connecter pour acc\xE9der \xE0 {$URL}",ja_JP:"{$URL}\u306B\u30A2\u30AF\u30BB\u30B9\u3059\u308B\u306B\u306F\u63A5\u7D9A\u3059\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059",nl_NL:"U moet verbinden om toegang te krijgen tot {$URL}",zh_CN:"\u60A8\u5FC5\u987B\u8FDE\u63A5\u624D\u80FD\u8BBF\u95EE{$URL}"},NAME_:{en_US:"Name",fr_FR:"Nom",ja_JP:"\u540D\u524D",nl_NL:"Naam",zh_CN:"\u59D3\u540D"},PASSWORD_:{en_US:"Password",de_DE:"Passwort",fr_FR:"Mot de passe",ja_JP:"\u30D1\u30B9\u30EF\u30FC\u30C9",nl_NL:"Wachtwoord",zh_CN:"\u5BC6\u7801"},P4_CONNECTION_ERROR_:{en_US:"Could not connect to Perforce server.",de_DE:"Konnte nicht mit Perforce-Server verbinden.",fr_FR:"Impossible de se connecter au serveur Perforce.",ja_JP:"Perforce\u30B5\u30FC\u30D0\u30FC\u306B\u63A5\u7D9A\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002",nl_NL:"Kan geen verbinding maken met de Perforce-server.",zh_CN:"\u65E0\u6CD5\u8FDE\u63A5\u5230Perforce\u670D\u52A1\u5668\u3002"},DISCONNECT_:{en_US:"Disconnect",de_DE:"Trennen",fr_FR:"D\xE9connexion",ja_JP:"\u5207\u65AD\u3059\u308B",nl_NL:"Verbinding verbreken",zh_CN:"\u65AD\u5F00\u8FDE\u63A5"},CANCEL_:{en_US:"Cancel",de_DE:"Abbrechen",fr_FR:"Annuler",ja_JP:"\u30AD\u30E3\u30F3\u30BB\u30EB",nl_NL:"Annuleer",zh_CN:"\u53D6\u6D88"},DISCONNECT_CONFIRMATION_:{en_US:"Are you sure you want to disconnect?",de_DE:"Sind Sie sicher, dass Sie die Verbindung trennen m\xF6chten?",fr_FR:"\xCAtes-vous s\xFBr de vouloir vous d\xE9connecter ?",ja_JP:"\u672C\u5F53\u306B\u5207\u65AD\u3057\u307E\u3059\u304B\uFF1F",nl_NL:"Weet u zeker dat u de verbinding wilt verbreken?",zh_CN:"\u60A8\u786E\u5B9A\u8981\u65AD\u5F00\u8FDE\u63A5\u5417\uFF1F"},UNSAVED_WILL_BE_LOST_:{en_US:"All your unsaved changes will be lost.",de_DE:"Alle ungespeicherten \xC4nderungen werden verloren gehen.",fr_FR:"Toutes vos modifications non enregistr\xE9es seront perdues.",ja_JP:"\u672A\u4FDD\u5B58\u306E\u3059\u3079\u3066\u306E\u5909\u66F4\u304C\u5931\u308F\u308C\u307E\u3059",nl_NL:"Alle niet-opgeslagen wijzigingen gaan verloren.",zh_CN:"\u6240\u6709\u672A\u4FDD\u5B58\u7684\u66F4\u6539\u90FD\u5C06\u4E22\u5931\u3002"},REVERT_:{en_US:"Revert",de_DE:"R\xFCckg\xE4ngig",fr_FR:"R\xE9tablir",ja_JP:"\u5143\u306B\u623B\u3059",nl_NL:"Laatst bewaarde versie",zh_CN:"\u8FD8\u539F"},REVERT_FAILED_:{en_US:"Failed to revert",de_DE:"Konnte nicht zur\xFCcksetzen",fr_FR:"R\xE9tablissement \xE9chou\xE9",ja_JP:"\u623B\u3059\u306E\u306B\u5931\u6557\u3057\u307E\u3057\u305F",nl_NL:"Terugdraaien mislukt",zh_CN:"\u65E0\u6CD5\u8FD8\u539F"},MUST_CHECK_OUT_:{en_US:"File must be checked out before editing.",de_DE:"Datei muss vor der Bearbeitung ausgecheckt werden.",fr_FR:"Le fichier doit \xEAtre extrait avant d'\xEAtre \xE9dit\xE9.",ja_JP:"\u7DE8\u96C6\u3059\u308B\u524D\u306B\u30D5\u30A1\u30A4\u30EB\u3092\u30C1\u30A7\u30C3\u30AF\u30A2\u30A6\u30C8\u3059\u308B\u5FC5\u8981\u304C\u3042\u308A\u307E\u3059\u3002",nl_NL:"Bestand moet worden uitgecheckt voordat het kan worden bewerkt.",zh_CN:"\u7F16\u8F91\u524D\u5FC5\u987B\u7B7E\u51FA\u6587\u4EF6\u3002"},FILE_SHELVED_:{en_US:"File backed up.",de_DE:"Datei gesichert.",fr_FR:"Copie de sauvegarde effectu\xE9e.",ja_JP:"\u30D5\u30A1\u30A4\u30EB\u304C\u30D0\u30C3\u30AF\u30A2\u30C3\u30D7\u3055\u308C\u307E\u3057\u305F\u3002",nl_NL:"Back-up van bestand gemaakt.",zh_CN:"\u6587\u4EF6\u5DF2\u5907\u4EFD\u3002"},SUBMIT_:{en_US:"Submit",de_DE:"Absenden",fr_FR:"Envoyer",ja_JP:"\u9001\u4FE1",nl_NL:"Verstuur",zh_CN:"\u63D0\u4EA4"},CHANGELIST_DESCRIPTION_:{en_US:"Enter changelist description:",de_DE:"\xC4nderungslistenbeschreibung eingeben:",fr_FR:"Entrez la description de la liste des modifications :",ja_JP:"\u5909\u66F4\u30EA\u30B9\u30C8\u306E\u8AAC\u660E\u3092\u5165\u529B\u3057\u3066\u304F\u3060\u3055\u3044\uFF1A",nl_NL:"Beschrijving van wijzigingslijst invoeren:",zh_CN:"\u8F93\u5165\u53D8\u66F4\u5217\u8868\u63CF\u8FF0\uFF1A"},SUMBIT_FAILED_:{en_US:"Submit failed",de_DE:"\xDCbertragung fehlgeschlagen",fr_FR:"\xC9chec de la soumission",ja_JP:"\u9001\u4FE1\u306B\u5931\u6557\u3057\u307E\u3057\u305F",nl_NL:"Indienen mislukt",zh_CN:"\u63D0\u4EA4\u5931\u8D25"},DOCUMENT_SUBMITTED_:{en_US:"Document submitted",de_DE:"Dokument \xFCbermittelt",fr_FR:"Document soumis",ja_JP:"\u30C9\u30AD\u30E5\u30E1\u30F3\u30C8\u3092\u9001\u4FE1\u3057\u307E\u3057\u305F",nl_NL:"Document ingediend",zh_CN:"\u63D0\u4EA4\u7684\u6587\u4EF6"},DESCRIPTION_EMPTY_:{en_US:"Changelist description is empty.",de_DE:"Beschreibung der \xC4nderungsliste ist leer.",fr_FR:"La description de la liste des modifications est vide.",ja_JP:"\u5909\u66F4\u30EA\u30B9\u30C8\u306E\u8AAC\u660E\u304C\u7A7A\u3067\u3059\u3002",nl_NL:"Beschrijving van wijzigingslijst is leeg.",zh_CN:"\u53D8\u66F4\u5217\u8868\u63CF\u8FF0\u4E3A\u7A7A\u3002"},SUBMIT_NO_CHANGES_:{en_US:"There are no changes to submit.",de_DE:"Es gibt keine zu \xFCbermittelnden \xC4nderungen.",fr_FR:"Il n'y a aucun changement \xE0 soumettre.",ja_JP:"\u9001\u4FE1\u3059\u308B\u5909\u66F4\u306F\u3042\u308A\u307E\u305B\u3093\u3002",nl_NL:"Er zijn geen wijzigingen die kunnen worden ingediend.",zh_CN:"\u6CA1\u6709\u8981\u63D0\u4EA4\u7684\u66F4\u6539\u3002"}};sync.Translation.addTranslations(e)})();function d(e,t){sync.actions.AbstractAction.call(this,"M1 E"),this.editor_=e,this.status_=t,localStorage.setItem("locked","false")}goog.inherits(d,sync.actions.AbstractAction);d.prototype.getDisplayName=function(){return tr(msgs.CHECK_OUT_)};d.prototype.isEnabled=function(){return!this.status_.isCheckedOut()};d.prototype.documentCheckedOut_=function(e,t,n){if(n==="success"){this.status_.setCheckedOut(!0),this.editor_.setReadOnlyState({readOnly:!1});var o=sync.options.PluginsOptions.getClientOption("perforce.backup_interval");parseInt(o)==o&&o>0&&(this.status_.backupHandlerId=setInterval(goog.bind(function(){var i=this.editor_.getActionsManager().getActionById("p4-shelve.id");i.actionPerformed(goog.nullFunction,!0)},this),o*1e3))}else this.editor_.setDirty(!1),workspace.getNotificationManager().showWarning(n);e&&e()};d.prototype.actionPerformed=function(e,t){this.editor_.getActionsManager().invokeOperation("com.oxygenxml.perforce.CheckoutOperation",{checkoutType:t},goog.bind(this.documentCheckedOut_,this,e),null,!1)};function h(e){this.editor_=e}h.prototype.checkFileIsShelved=function(){this.editor_.getActionsManager().invokeOperation("com.oxygenxml.perforce.CheckShelfOperation",{},goog.bind(this.shelfChecked_,this),null,!0)};h.prototype.shelvedFileDeleted_=function(e,t){t==="success"?workspace.getNotificationManager().showInfo(tr(msgs.BACKUP_DELETED_NOTIFICATION_)):t==="failed"&&workspace.getNotificationManager().showError(tr(msgs.BACKUP_DELETE_FAILED_))};h.prototype.shelfChecked_=function(e,t){if(t==="unauthorized")login(window.location.href,function(){});else if(t==="failed")workspace.getNotificationManager().showError(tr(msgs.FILE_SHELVED_ERROR_));else if(t!=="-1"){var n=workspace.createDialog();n.setTitle(tr(msgs.BACKUP_FOUND_DIALOG_TITLE_)),n.setButtonConfiguration([{key:"openBackup",caption:tr(msgs.OPEN_BACKUP_)},{key:"deleteBackup",caption:tr(msgs.DELETE_BACKUP_),cancel:!1}]),n.onSelect(goog.bind(function(o,i){if(o==="openBackup"){var r=this.editor_.getActionsManager().getActionById("p4-checkout.id");r.actionPerformed(goog.nullFunction,"shelveCheckout"),this.editor_.setDirty(!0)}else o==="deleteBackup"&&this.editor_.getActionsManager().invokeOperation("com.oxygenxml.perforce.DeleteShelved",{},goog.bind(this.shelvedFileDeleted_,this),null,!0)},this)),goog.dom.append(n.getElement(),goog.dom.createDom("div",{style:"height:auto; line-height: 1.3;"},trDom(msgs.BACKUP_FOUND_DIALOG_MSG_,{$LINE_BREAK:goog.dom.createDom("br")}))),n.show()}};function v(e){this.checkedOut_=e}v.prototype.isCheckedOut=function(){return this.checkedOut_};v.prototype.setCheckedOut=function(e){this.checkedOut_=e};function c(e,t){if(this.perforceServerHost_=e,this.perforceServerPort_=t,this.perforceConfigDone_=e&&t,this.visualRootUrl_=e+":"+t,this.rootUrl_="p4java://"+e+":"+t+"//",this.loginDialog_=null,this.username_=null,this.perforceConfigDone_)try{this.username_=localStorage.getItem("p4.user"),this.username_&&localStorage.setItem("p4.latestRootUrl",this.rootUrl_)}catch{}else try{localStorage.removeItem("p4.latestRootUrl"),localStorage.removeItem("p4.latestUrl"),localStorage.removeItem("p4.user")}catch{}this.redirectOnLoginCancel_=!1,goog.events.listen(workspace,sync.api.Workspace.EventType.BEFORE_EDITOR_LOADED,goog.bind(function(){this.redirectOnLoginCancel_=!0},this)),goog.events.listen(workspace,sync.api.Workspace.EventType.EDITOR_LOADED,goog.bind(function(){this.redirectOnLoginCancel_=!1},this))}c.prototype.createRootUrlComponent=function(e,t,n){if(this.perforceConfigDone_){var o=goog.dom.getElementByClass("file-server-login-container");if(o&&goog.dom.removeChildren(o),this.username_)return goog.dom.createDom("div","",this.perforceServerHost_+":"+this.perforceServerPort_);o&&this.createInlineLoginDialog_(o,this.rootUrl_,goog.bind(function(){t(this.rootUrl_,null)},this))}else return goog.dom.createDom("div","",trDom(msgs.PERFORCE_NOT_CONFIGURED_,{$ADMINISTRATION_PAGE:goog.dom.createDom("a",{href:"admin.html",target:"_blank"},tr(msgs.ADMINISTRATION_PAGE_))}))};c.prototype.getUrlInfo=function(e,t,n){var o="p4java://"+this.perforceServerHost_+":"+this.perforceServerPort_+"/",i=new RegExp(o+"\\w+/"),r=e.match(i);t(r?r[0]:this.rootUrl_,e)};c.prototype.getUserName=function(){return this.username_||""};c.prototype.login=function(e,t){this.loginDialog_||(this.loginDialog_=workspace.createDialog(),this.createLoginDialogForm_(this.loginDialog_.getElement()),this.loginDialog_.setTitle(tr(msgs.CONNECT_)),this.loginDialog_.setPreferredSize(300,null)),this.loginDialog_.onSelect(goog.bind(function(r){var a=document.getElementById("p4-name"),s=document.getElementById("p4-passwd");if(r==="ok"){var g=a.value.trim(),E=s.value;this.login_(g,E,e,goog.bind(function(N){N?t():this.login(e,t)},this))}else if(this.redirectOnLoginCancel_){var u=window.location;window.location.href=u.protocol+"//"+u.hostname+(u.port?":"+u.port:"")+u.pathname}s.value=""},this)),this.loginDialog_.show();var n=localStorage.getItem("p4.user");if(n){var o=this.loginDialog_.getElement(),i=o.querySelector("#p4-name");i.value=n,i.select()}};c.prototype.logout=function(e){goog.net.XhrIo.send("../plugins-dispatcher/p4login?action=logout&server="+this.rootUrl_,goog.bind(function(){this.username_=null,localStorage.removeItem("p4.latestRootUrl"),localStorage.removeItem("p4.latestUrl"),localStorage.removeItem("p4.user"),e()},this),"POST","",{"X-Requested-With":"shp"})};c.prototype.createInlineLoginDialog_=function(e,t,n){var o=goog.dom.createDom("form","modal-dialog-content p4-inline-dialog-container");e.appendChild(o),this.createLoginDialogForm_(o),o.insertBefore(goog.dom.createDom("div","p4-login-msg",trDom(msgs.CONNECT_TO_ACCESS_,{$URL:goog.dom.createDom("span","p4-highlighted",this.visualRootUrl_)})),o.firstChild),o.appendChild(goog.dom.createDom("button",{type:"submit",style:"line-height: normal; margin-top: 12px; float: right",class:"oxy-button oxy-small-button oxy-primary-button"},tr(msgs.CONNECT_))),goog.events.listen(o,goog.events.EventType.SUBMIT,goog.bind(function(i){i.preventDefault();var r=o.querySelector("#p4-name"),a=r.value.trim(),s=o.querySelector("#p4-passwd"),g=s.value;s.value="",this.login_(a,g,t,function(E){E&&n()})},this))};c.prototype.createLoginDialogForm_=function(e){var t=goog.dom.createDom,n=t("input",{id:"p4-name",type:"text",class:"oxy-input",autocomplete:"username",autocorrect:"off",autocapitalize:"none",autofocus:""}),o=t("input",{className:"oxy-input",id:"p4-passwd",type:"password",autocomplete:"current-password"});goog.dom.append(e,t("div","p4-login-dialog",t("label","",tr(msgs.NAME_),n),t("label",{style:"margin-top: 12px"},tr(msgs.PASSWORD_),o)));var i=t("div",{id:"p4-login-msg",style:"line-height:20px; color:red; margin-top: 8px;"});goog.dom.append(e,i)};c.prototype.login_=function(e,t,n,o){goog.net.XhrIo.send("../plugins-dispatcher/p4login",goog.bind(function(i){var r=i.target,a=r.getStatus();a===403?(document.getElementById("p4-login-msg").textContent=r.getResponse(),o(!1)):a===500?(document.getElementById("p4-login-msg").textContent=tr(msgs.P4_CONNECTION_ERROR_),o(!1)):(localStorage.setItem("p4.user",e),this.username_=e,o(!0))},this),"POST",goog.Uri.QueryData.createFromMap(new goog.structs.Map({user:e,passwd:t,server:n})).toString(),{"X-Requested-With":"shp"})};function f(e,t){this.editor_=e,this.fileBrowser_=t,this.dialog_=null}goog.inherits(f,sync.actions.AbstractAction);f.prototype.getDialog_=function(){if(!this.dialog_){var e=workspace.createDialog();e.setTitle(tr(msgs.DISCONNECT_)),e.setButtonConfiguration([{key:"yes",caption:tr(msgs.DISCONNECT_)},{key:"no",caption:tr(msgs.CANCEL_)}]);var t=this.editor_&&this.editor_.isDirty();goog.dom.append(e.getElement(),goog.dom.createDom("div","",tr(msgs.DISCONNECT_CONFIRMATION_),goog.dom.createDom("br"),t?tr(msgs.UNSAVED_WILL_BE_LOST_):"")),this.dialog_=e}return this.dialog_};f.prototype.actionPerformed=function(){var e=this.getDialog_();e.onSelect(goog.bind(function(t,n){t==="yes"&&(n.preventDefault(),goog.net.XhrIo.send("../plugins-dispatcher/p4login?action=logout&server="+this.fileBrowser_.getLatestRootUrl(),goog.bind(function(){e.hide(),localStorage.removeItem("p4.latestUrl"),localStorage.removeItem("p4.latestRootUrl"),localStorage.removeItem("p4.user"),sync.util.getURLParameter("url")?(this.editor_&&this.editor_.setDirty(!1),sync.util.setUrlParameter("url"),window.location.reload()):(this.fileBrowser_.switchToRepoConfig(),this.fileBrowser_.dialog.hide(),this.fileBrowser_.candidateUrl=null)},this),"POST","",{"X-Requested-With":"shp"}))},this)),e.setPreferredSize(320,185),e.show()};f.prototype.getDisplayName=function(){return tr(msgs.DISCONNECT_)};function l(e,t){this.editor_=e,this.status_=t,this.dialog_=null}goog.inherits(l,sync.actions.AbstractAction);l.prototype.getDisplayName=function(){return tr(msgs.REVERT_)};l.prototype.isEnabled=function(){return this.status_.isCheckedOut()};l.prototype.getDialog_=function(){if(!this.dialog_){var e=workspace.createDialog();e.setTitle(tr(msgs.REVERT_)),e.setButtonConfiguration([{key:"revert",caption:tr(msgs.REVERT_)},{key:"cancel",caption:tr(msgs.CANCEL_)}]),goog.dom.append(e.getElement(),goog.dom.createDom("div","",tr(msgs.UNSAVED_WILL_BE_LOST_))),this.dialog_=e}return this.dialog_};l.prototype.documentReverted_=function(e,t,n){n==="failed"?workspace.getNotificationManager().showInfo(tr(msgs.REVERT_FAILED_)):n==="success"&&(this.editor_.setReadOnlyState({readOnly:!0,message:tr(msgs.MUST_CHECK_OUT_)}),this.editor_.setDirty(!1),this.status_.setCheckedOut(!1),clearInterval(this.status_.backupHandlerId)),e&&e()};l.prototype.actionPerformedInternal_=function(e){this.editor_.getActionsManager().invokeOperation("com.oxygenxml.perforce.RevertOperation",{},goog.bind(this.documentReverted_,this,e),null,!1)};l.prototype.actionPerformed=function(e){if(this.editor_.isDirty()){var t=this.getDialog_();t.onSelect(goog.bind(function(n,o){n==="revert"?this.actionPerformedInternal_(e):e&&e()},this)),t.show()}else this.actionPerformedInternal_(e)};function p(e,t){sync.actions.AbstractAction.call(this,"M1 M2 3"),this.editor_=e,this.status_=t,goog.events.listen(e.getController(),sync.ctrl.Controller.EventType.MODEL_CHANGED,goog.bind(function(){this.status_.backedUp=!1},this))}goog.inherits(p,sync.actions.AbstractAction);p.prototype.documentShelved_=function(e,t,n,o){o==="unauthorized"?login(window.location.href,function(){}):o==="failed"?t||workspace.getNotificationManager().showError(tr(msgs.FILE_SHELVED_ERROR_)):o==="success"&&(this.editor_.setReadOnlyState({readOnly:!1,message:tr(msgs.MUST_CHECK_OUT_)}),this.status_.backedUp=!0,t||workspace.getNotificationManager().showInfo(tr(msgs.FILE_SHELVED_))),e&&e()};p.prototype.actionPerformed=function(e,t){this.invoke(e,t)};p.prototype.invoke=function(e,t){!this.status_.backedUp&&this.editor_.isDirty()?this.editor_.getActionsManager().invokeOperation("com.oxygenxml.perforce.SaveOperation",{saveOperationType:"shelve"},goog.bind(this.documentShelved_,this,e,t),null,!0):e&&e()};function _(e,t){sync.actions.AbstractAction.call(this,"M1 S"),this.editor_=e,this.status_=t,this.dialog_=null}goog.inherits(_,sync.actions.AbstractAction);_.prototype.getDisplayName=function(){return tr(msgs.SUBMIT_)};_.prototype.isEnabled=function(){return this.status_.isCheckedOut()};_.prototype.getDialog_=function(){if(this.dialog_){var t=document.querySelector("#changelistDesc");t&&(t.value="")}else{var e=workspace.createDialog();e.setTitle(tr(msgs.SUBMIT_)),e.setButtonConfiguration([{key:"submit",caption:tr(msgs.SUBMIT_)},{key:"cancel",caption:tr(msgs.CANCEL_)}]),goog.dom.append(e.getElement(),goog.dom.createDom("div","",tr(msgs.CHANGELIST_DESCRIPTION_),goog.dom.createDom("form","",goog.dom.createDom("textarea",{id:"changelistDesc"})))),this.dialog_=e}return this.dialog_};_.prototype.documentSubmitted_=function(e,t,n){n==="unauthorized"?login(window.location.href,function(){}):n==="failed"?workspace.getNotificationManager().showError(tr(msgs.SUMBIT_FAILED_)):n==="success"&&(this.editor_.setReadOnlyState({readOnly:!0,message:tr(msgs.MUST_CHECK_OUT_)}),this.editor_.setDirty(!1),this.status_.setCheckedOut(!1),clearInterval(this.status_.backupHandlerId),this.dialog_.hide(),e(),workspace.getNotificationManager().showInfo(tr(msgs.DOCUMENT_SUBMITTED_)))};_.prototype.actionPerformed=function(e){e=e||goog.nullFunction;var t=this.getDialog_();this.editor_.isDirty()?(t.setContentPreferredSize(385,null),t.onSelect(goog.bind(function(n,o){if(n==="submit"){var i=document.getElementById("changelistDesc").value.trim();i.length===0?(workspace.getNotificationManager().showWarning(tr(msgs.DESCRIPTION_EMPTY_)),e()):(o.preventDefault(),this.editor_.getActionsManager().invokeOperation("com.oxygenxml.perforce.SaveOperation",{changelistDesc:i,saveOperationType:"submitShelved"},goog.bind(this.documentSubmitted_,this,e),null,!0))}else e()},this)),t.show()):(workspace.getNotificationManager().showInfo(tr(msgs.SUBMIT_NO_CHANGES_)),e())};var D="Perforce Helix",C=new c(sync.options.PluginsOptions.getClientOption("perforce.server_host"),sync.options.PluginsOptions.getClientOption("perforce.server_port")),m=/^p4java:\/\//;goog.events.listen(workspace,sync.api.Workspace.EventType.EDITOR_LOADED,function(e){var t=e.editor.options.url;if(t.match(m)){var n=new h(e.editor);n.checkFileIsShelved()}});goog.events.listen(workspace,sync.api.Workspace.EventType.BEFORE_EDITOR_LOADED,function(e){e.options.previewMode||goog.events.listenOnce(workspace,sync.api.Workspace.EventType.EDITOR_LOADED,function(t){t.editor.getUrl().match(m)&&t.editor.setReadOnlyState({readOnly:!0,message:tr(msgs.MUST_CHECK_OUT_)})})});goog.events.listen(workspace,sync.api.Workspace.EventType.BEFORE_EDITOR_LOADED,function(e){var t=e.options.url;if(t.match(m)){var n=localStorage.getItem("p4.user");n&&(e.options.userName=n);var o=e.editor;e.options.previewMode||goog.events.listenOnce(o,sync.api.Editor.EventTypes.ACTIONS_LOADED,goog.bind(y,this,o)),goog.events.listen(o,sync.api.Editor.EventTypes.CUSTOM_MESSAGE_RECEIVED,function(i){var r=i.context,a=i.message.message;C.login(a,function(){if(r===sync.api.Editor.WebappMessageReceived.Context.LOAD)window.location.reload();else if(r===sync.api.Editor.WebappMessageReceived.Context.EDITING)o.getActionsManager().invokeAction("Author/Refresh_references");else if(r===sync.api.Editor.WebappMessageReceived.Context.SAVE)o.getActionsManager().getActionById("Author/Save").actionPerformed(function(){});else if(r===sync.api.Editor.WebappMessageReceived.Context.IMAGE)for(var s=document.querySelectorAll("img[data-src]"),g=0;g<s.length;g++)s[g].src=goog.dom.dataset.get(s[g],"src")})})}});var S=workspace.getFileServersManager();S.registerFileServerConnector({id:"p4",name:D,icon:sync.util.computeHdpiIcon("../plugin-resources/p4/perforce70.png"),matches:function(e){return!!e.match(m)},fileServer:C});function y(e,t){var n=t.actionsConfiguration,o=null;if(n.toolbars)for(var i=0;i<n.toolbars.length;i++){var r=n.toolbars[i];r.name==="Builtin"&&(o=r)}var a=new v(!1),s=e.getActionsManager();s.registerAction("p4-checkout.id",new d(e,a)),s.unregisterAction("Author/Save"),s.registerAction("p4-shelve.id",new p(e,a)),s.registerAction("p4-submit.id",new _(e,a)),s.registerAction("p4-revert.id",new l(e,a)),o&&o.children.push({displayName:D,type:"list",name:"p4-actions",children:[{id:"p4-checkout.id",type:"action"},{id:"p4-submit.id",type:"action"},{id:"p4-revert.id",type:"action"}]})}})();
