function completeAfter(e,t){return t&&!t()||setTimeout(function(){e.state.completionActive||e.showHint({completeSingle:!1})},100),window.CodeMirror.Pass}function completeIfAfterLt(t){return completeAfter(t,function(){var e=t.getCursor();return"<"===t.getRange(window.CodeMirror.Pos(e.line,e.ch-1),e)})}function saveDocument(){window.save&&window.save()}function isOnMobileDevice(){return navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)|(android)|(webOS)/i)}window.editor=window.CodeMirror.fromTextArea(document.getElementById("code"),{mode:"xml",lineNumbers:!0,autofocus:"on",extraKeys:{"'/'":completeIfAfterLt,"Ctrl-Space":"autocomplete","Ctrl-S":saveDocument,"Cmd-S":saveDocument,"Ctrl-F":"findPersistent","Cmd-F":"findPersistent"},hintOptions:{schemaInfo:{}},readOnly:window.readOnlyState,lineWrapping:!0}),window.editor.setSize("100%","100%"),window.onfocus=function(){window.editor.focus()};var frInfoButtonClass="fr-usage-info",frInfoPopupClass="fr-information",closeInfoBox=function(e,t){e=e||document.querySelector("."+frInfoPopupClass),t=t||document.querySelector("."+frInfoButtonClass),e.getAttribute("class")!==frInfoPopupClass&&e.setAttribute("class",frInfoPopupClass),t.getAttribute("class")!==frInfoButtonClass&&t.setAttribute("class",frInfoButtonClass)},findShortcutHandler=function(e){var t=e.keyCode;(e.ctrlKey||e.metaKey)&&e.shiftKey&&70===t?(window.editor.execCommand("replace"),e.preventDefault()):!e.ctrlKey&&!e.metaKey||70!==t&&71!==t?e.altKey&&70===t?(window.editor.execCommand("jumpToLine"),e.preventDefault()):closeInfoBox():e.preventDefault()},toggleInfoBox=function(){var e=document.querySelector("."+frInfoPopupClass),t=document.querySelector("."+frInfoButtonClass);e.getAttribute("class")!==frInfoPopupClass?closeInfoBox(e,t):(e.setAttribute("class",frInfoPopupClass+" visible"),t.setAttribute("class",frInfoButtonClass+" active"))};function initEditor(){function e(e,t,n){var o=isOnMobileDevice(),r=document.createElement("div");return r.setAttribute("class","frOption "+e),r.textContent=t,o||((e=document.createElement("div")).setAttribute("class","shortcut"),-1!==navigator.platform.toUpperCase().indexOf("MAC")&&(n=n.replace("CTRL","âŒ˜")),e.textContent=n,r.appendChild(e)),r}window.editor&&window.textState&&(o=window.editor,n=window.textState.xmlContent,o.setValue(n),o.textWasInitialized=!0,1<=(t=n.indexOf(r="\n"))&&"\r"===n.charAt(t-1)&&(r="\r\n"),t=window.textState.caretOffset,t-=(n.substring(0,t).match(/\n/g)||[]).length*(r.length-1),n=o.posFromIndex(t),o.setCursor(n),o.scrollIntoView(n),o.markClean(),o.clearHistory(),window.editor.setOption("lineSeparator",r));var t=window.parent.iframeSpinner,n=(t&&t.hide(),window.parent.tr),o=window.parent.msgs,r=(document.querySelector("body").addEventListener("keydown",findShortcutHandler),document.createElement("div")),t=(r.setAttribute("class",frInfoButtonClass),document.createElement("div")),i=(t.setAttribute("class",frInfoPopupClass),e("Foption",n(o.FIND_),"CTRL+F")),s=e("FRoption",n(o.FIND_REPLACE_),"CTRL+SHIFT+F"),n=e("FLoption",n(o.JUMP_TO_LINE_),"ALT+F"),o=(t.appendChild(i),t.appendChild(s),t.appendChild(n),document.querySelector(".CodeMirror"));o.appendChild(r),o.appendChild(t),r.addEventListener("keyup",findShortcutHandler),r.addEventListener("click",function(){toggleInfoBox()}),i.addEventListener("click",function(){window.editor.execCommand("findPersistent")}),s.addEventListener("click",function(){window.editor.execCommand("replace")}),n.addEventListener("click",function(){window.editor.execCommand("jumpToLine")}),document.querySelector(".CodeMirror-lines").addEventListener("click",function(){closeInfoBox()})}function getState(){var e=window.editor;return{content:e.getValue(),caret:e.indexFromPos(e.getCursor())}}initEditor();